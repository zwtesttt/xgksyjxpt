<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xgksyjxpt.xgksyjxpt.course.mapper.course.CourseMapper" >
  <resultMap id="BaseResultMap" type="com.xgksyjxpt.xgksyjxpt.course.domain.course.Course" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Dec 17 21:33:47 CST 2022.
    -->
    <id column="cid" property="cid" jdbcType="VARCHAR" />
    <result column="cname" property="cname" jdbcType="VARCHAR" />
    <result column="course_start" property="courseStart" jdbcType="TIMESTAMP" />
    <result column="course_end" property="courseEnd" jdbcType="TIMESTAMP" />
    <result column="xuefen" property="xuefen" jdbcType="INTEGER" />
    <result column="description" property="description" jdbcType="VARCHAR" />
    <result column="tid" property="tid" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Dec 17 21:33:47 CST 2022.
    -->
    cid, cname, course_start, course_end, xuefen, description, tid,course_status
  </sql>
<!--  查询课程总数-->
  <select id="queryTeacherCount" resultType="int" parameterType="com.xgksyjxpt.xgksyjxpt.course.domain.course.Course">
    select count(*) from course_t where delete_time is null
    <if test="cid !=null and cid!=''">
      and cid like '%' #{cid} '%'
    </if>
    <if test="cname !=null and cname!=''">
      and cname like '%' #{cname} '%'
    </if>
    <if test="courseStart !=null and courseStart!=''">
      and course_start&gt;=#{courseStart}
    </if>
    <if test="courseEnd !=null and courseEnd!=''">
      and course_end&lt;=#{courseEnd}
    </if>
    <if test="xuefen !=null and xuefen!=''">
      and xuefen=#{xuefen}
    </if>
    <if test="tid !=null and tid!=''">
      and tid like '%' #{tid} '%'
    </if>
    <if test="course_status !=null and course_status!=''">
      and course_status like '%' #{course_status} '%'
    </if>
  </select>
  <!--添加新课程-->
  <insert id="insertCourse" parameterType="com.xgksyjxpt.xgksyjxpt.course.domain.course.Course">
    insert into course_t(cid, cname, course_start, course_end, xuefen, description, tid,course_status) values(#{cid},#{cname},#{courseStart},#{courseEnd},#{xuefen},#{description},#{tid},#{course_status})
  </insert>
<!--  删除课程-->
  <update id="deleteCourse" parameterType="string">
    update course_t set course_status='已删除',delete_time=NOW() where cid=#{cid} and delete_time is null
  </update>
<!--  根据课程号查询课程信息-->
  <select id="selectCourseByCid" parameterType="string" resultType="com.xgksyjxpt.xgksyjxpt.course.domain.course.Course">
    select
      cid, cname, course_start, course_end, xuefen, description, tid,course_status
    from course_t where cid=#{cid} and delete_time is null
  </select>
  <!--  根据教师号查询课程号-->
  <select id="selectCourseIdByTid" resultType="string" parameterType="string">
    select cid from course_t where tid=#{tid} and delete_time is null
  </select>
<!--  根据多个课程号删除课程-->
  <update id="deleteCoursesByCids" parameterType="string">
    update course_t set course_status='已删除',delete_time=NOW() where cid in(
    <foreach collection="array" item="cids" separator=",">
      #{cids}
    </foreach>
    ) and delete_time is null
  </update>
<!--  查询所有课程-->
  <select id="queryAllCourse" resultType="com.xgksyjxpt.xgksyjxpt.course.domain.course.Course">
    select
    <include refid="Base_Column_List"></include>
    from course_t where delete_time is null
    <if test="course.cid !=null and course.cid!=''">
      and cid like '%' #{course.cid} '%'
    </if>
    <if test="course.cname !=null and course.cname!=''">
      and cname like '%' #{course.cname} '%'
    </if>
    <if test="course.courseStart !=null and course.courseStart!=''">
      and course_start&gt;=#{course.courseStart}
    </if>
    <if test="course.courseEnd !=null and course.courseEnd!=''">
      and course_end&lt;=#{course.courseEnd}
    </if>
    <if test="course.xuefen !=null and course.xuefen!=''">
      and xuefen=#{course.xuefen}
    </if>
    <if test="course.tid !=null and course.tid!=''">
      and tid like '%' #{course.tid} '%'
    </if>
    <if test="course.course_status !=null and course.course_status!=''">
      and course_status like '%' #{course.courseStatus} '%'
    </if>
    limit #{pageNum},#{pageSize}
  </select>
<!--  创建定时任务-->
  <update id="createEvent">
    CREATE EVENT ${eventName}
    ON SCHEDULE AT TIMESTAMP #{date}
    DO update course_t set course_status=#{courseStatus} where cid=#{cid} and delete_time is null
  </update>
<!--  删除定时任务-->
  <update id="deleteCourseEvent">
    drop event if exists ${eventName};
  </update>
<!--  查询老师课程信息-->
  <select id="selectCourseByTid" resultType="com.xgksyjxpt.xgksyjxpt.course.domain.course.Course">
    select
    <include refid="Base_Column_List"></include>
    from course_t where tid=#{tid} and delete_time is null
    <if test="courseName !=null and courseName!=''">
      and cname like '%' #{courseName} '%'
    </if>

  </select>
<!--  修改课程信息-->
  <update id="updateCourseInfo" parameterType="string">
    update course_t set
        cname=#{cname}
        ,course_start=#{courseStart}
        ,course_end=#{courseEnd}
        ,xuefen=#{xuefen}
        <if test="description != '' and description != null">
          ,description=#{description}
        </if>
        ,course_status=#{courseStatus}
    where cid=#{cid} and delete_time is null
  </update>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Dec 17 21:33:47 CST 2022.
    -->
    select 
    <include refid="Base_Column_List" />
    from course_t
    where cid = #{cid,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Dec 17 21:33:47 CST 2022.
    -->
    delete from course_t
    where cid = #{cid,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.xgksyjxpt.xgksyjxpt.course.domain.course.Course" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Dec 17 21:33:47 CST 2022.
    -->
    insert into course_t (cid, cname, course_start, 
      course_end, xuefen, description, 
      tid)
    values (#{cid,jdbcType=VARCHAR}, #{cname,jdbcType=VARCHAR}, #{course_start,jdbcType=TIMESTAMP}, 
      #{course_end,jdbcType=TIMESTAMP}, #{xuefen,jdbcType=INTEGER}, #{description,jdbcType=VARCHAR}, 
      #{tid,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.xgksyjxpt.xgksyjxpt.course.domain.course.Course" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Dec 17 21:33:47 CST 2022.
    -->
    insert into course_t
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="cid != null" >
        cid,
      </if>
      <if test="cname != null" >
        cname,
      </if>
      <if test="course_start != null" >
        course_start,
      </if>
      <if test="course_end != null" >
        course_end,
      </if>
      <if test="xuefen != null" >
        xuefen,
      </if>
      <if test="description != null" >
        description,
      </if>
      <if test="tid != null" >
        tid,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="cid != null" >
        #{cid,jdbcType=VARCHAR},
      </if>
      <if test="cname != null" >
        #{cname,jdbcType=VARCHAR},
      </if>
      <if test="course_start != null" >
        #{course_start,jdbcType=TIMESTAMP},
      </if>
      <if test="course_end != null" >
        #{course_end,jdbcType=TIMESTAMP},
      </if>
      <if test="xuefen != null" >
        #{xuefen,jdbcType=INTEGER},
      </if>
      <if test="description != null" >
        #{description,jdbcType=VARCHAR},
      </if>
      <if test="tid != null" >
        #{tid,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.xgksyjxpt.xgksyjxpt.course.domain.course.Course" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Dec 17 21:33:47 CST 2022.
    -->
    update course_t
    <set >
      <if test="cname != null" >
        cname = #{cname,jdbcType=VARCHAR},
      </if>
      <if test="course_start != null" >
        course_start = #{course_start,jdbcType=TIMESTAMP},
      </if>
      <if test="course_end != null" >
        course_end = #{course_end,jdbcType=TIMESTAMP},
      </if>
      <if test="xuefen != null" >
        xuefen = #{xuefen,jdbcType=INTEGER},
      </if>
      <if test="description != null" >
        description = #{description,jdbcType=VARCHAR},
      </if>
      <if test="tid != null" >
        tid = #{tid,jdbcType=VARCHAR},
      </if>
    </set>
    where cid = #{cid,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.xgksyjxpt.xgksyjxpt.course.domain.course.Course" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Dec 17 21:33:47 CST 2022.
    -->
    update course_t
    set cname = #{cname,jdbcType=VARCHAR},
      course_start = #{course_start,jdbcType=TIMESTAMP},
      course_end = #{course_end,jdbcType=TIMESTAMP},
      xuefen = #{xuefen,jdbcType=INTEGER},
      description = #{description,jdbcType=VARCHAR},
      tid = #{tid,jdbcType=VARCHAR}
    where cid = #{cid,jdbcType=VARCHAR}
  </update>
</mapper>