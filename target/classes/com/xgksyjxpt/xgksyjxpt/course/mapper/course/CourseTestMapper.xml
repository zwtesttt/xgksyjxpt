<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xgksyjxpt.xgksyjxpt.course.mapper.course.CourseTestMapper" >
  <resultMap id="BaseResultMap" type="com.xgksyjxpt.xgksyjxpt.course.domain.course.CourseTest" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Dec 18 16:38:23 CST 2022.
    -->
    <id column="test_id" property="test_id" jdbcType="VARCHAR" />
    <result column="cid" property="cid" jdbcType="VARCHAR" />
    <result column="test_name" property="test_name" jdbcType="VARCHAR" />
    <result column="test_image_name" property="test_image_name" jdbcType="VARCHAR" />
    <result column="test_start_time" property="test_start_time" jdbcType="TIMESTAMP" />
    <result column="test_end_time" property="test_end_time" jdbcType="TIMESTAMP" />
  </resultMap>
  <resultMap id="ResultMapWithBLOBs" type="com.xgksyjxpt.xgksyjxpt.course.domain.course.CourseTest" extends="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Dec 18 16:38:23 CST 2022.
    -->
    <result column="test_description" property="test_description" jdbcType="LONGVARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Dec 18 16:38:23 CST 2022.
    -->
    test_id, cid, chapter_id,test_name, test_image_name,test_description,test_start_time, test_end_time,test_status
  </sql>
  <sql id="Blob_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Dec 18 16:38:23 CST 2022.
    -->
    test_description
  </sql>
<!--  查询课程实验总数-->
  <select id="queryCourseCountByTidOrSid" resultType="int">
    select count(*)
    <if test="sid !=null and sid!=''">
      from course_test_t ct,student_test_t st where ct.delete_time is null and st.delete_time is null and st.sid=#{sid} and ct.test_id=st.test_id
      <if test="courseTest.cid !=null and courseTest.cid!=''">
        and ct.cid=#{courseTest.cid}
      </if>
      <if test="courseTest.testId !=null and courseTest.testId!=''">
        and ct.test_id like '%' #{courseTest.testId} '%'
      </if>
      <if test="courseTest.testName !=null and courseTest.testName!=''">
        and ct.test_name like '%' #{courseTest.testName} '%'
      </if>
      <if test="courseTest.testImageName !=null and courseTest.testImageName!=''">
        and ct.test_image_name like '%' #{courseTest.testImageName} '%'
      </if>
      <if test="courseTest.testStartTime !=null and courseTest.testStartTime!=''">
        and ct.test_start_time&gt;=#{courseTest.testStartTime}
      </if>
      <if test="courseTest.testEndTime !=null and courseTest.testEndTime!=''">
        and ct.test_end_time&lt;=#{courseTest.testEndTime}
      </if>
      <if test="courseTest.testStatus !=null and courseTest.testStatus!=''">
        and ct.test_status like '%' #{courseTest.testStatus} '%'
      </if>
      <if test="courseTest.chapterId !=null and courseTest.chapterId!=''">
        and ct.chapter_id=#{courseTest.chapterId}
      </if>
    </if>
    <if test="tid !=null and tid!=''">
      from course_test_t ct,course_t cct where ct.delete_time is null and cct.delete_time is null and cct.tid=#{tid} and ct.cid=cct.cid
      <if test="courseTest.cid !=null and courseTest.cid!=''">
        and ct.cid=#{courseTest.cid}
      </if>
      <if test="courseTest.testId !=null and courseTest.testId!=''">
        and ct.test_id like '%' #{courseTest.testId} '%'
      </if>
      <if test="courseTest.testName !=null and courseTest.testName!=''">
        and ct.test_name like '%' #{courseTest.testName} '%'
      </if>
      <if test="courseTest.testImageName !=null and courseTest.testImageName!=''">
        and ct.test_image_name like '%' #{courseTest.testImageName} '%'
      </if>
      <if test="courseTest.testStartTime !=null and courseTest.testStartTime!=''">
        and ct.test_start_time&gt;=#{courseTest.testStartTime}
      </if>
      <if test="courseTest.testEndTime !=null and courseTest.testEndTime!=''">
        and ct.test_end_time&lt;=#{courseTest.testEndTime}
      </if>
      <if test="courseTest.testStatus !=null and courseTest.testStatus!=''">
        and ct.test_status like '%' #{courseTest.testStatus} '%'
      </if>
      <if test="courseTest.chapterId !=null and courseTest.chapterId!=''">
        and ct.chapter_id=#{courseTest.chapterId}
      </if>
    </if>
    <if test="sid ==null and sid=='' and tid ==null and tid==''">
      from course_test_t where delete_time is null
      <if test="courseTest.cid !=null and courseTest.cid!=''">
        and cid=#{courseTest.cid}
      </if>
      <if test="courseTest.testId !=null and courseTest.testId!=''">
        and test_id like '%' #{courseTest.testId} '%'
      </if>
      <if test="courseTest.testName !=null and courseTest.testName!=''">
        and test_name like '%' #{courseTest.testName} '%'
      </if>
      <if test="courseTest.testImageName !=null and courseTest.testImageName!=''">
        and test_image_name like '%' #{courseTest.testImageName} '%'
      </if>
      <if test="courseTest.testStartTime !=null and courseTest.testStartTime!=''">
        and test_start_time&gt;=#{courseTest.testStartTime}
      </if>
      <if test="courseTest.testEndTime !=null and courseTest.testEndTime!=''">
        and test_end_time&lt;=#{courseTest.testEndTime}
      </if>
      <if test="courseTest.testStatus !=null and courseTest.testStatus!=''">
        and test_status like '%' #{courseTest.testStatus} '%'
      </if>
      <if test="courseTest.chapterId !=null and courseTest.chapterId!=''">
        and chapter_id=#{courseTest.chapterId}
      </if>
    </if>
  </select>
  <!--  添加课程实验-->
  <insert id="insertCourseTest" parameterType="com.xgksyjxpt.xgksyjxpt.course.domain.course.CourseTest">
    insert into course_test_t(test_id, cid, chapter_id,test_name, test_image_name,test_description,test_start_time, test_end_time,test_status)
    values(#{test_id},#{cid},#{chapterId},#{test_name},#{test_image_name},#{test_description},#{test_start_time},#{test_end_time},#{test_status})
  </insert>
  <!--  创建定时任务-->
  <update id="createCourseTestEvent">
    CREATE EVENT ${eventName}
    ON SCHEDULE AT TIMESTAMP #{date}
    DO update course_test_t set test_status=#{testStatus} where test_id=#{testId} and delete_time is null
  </update>
<!--  删除课程定时任务-->
  <update id="deleteCourseTestEvent">
    drop event if exists ${eventName};
  </update>
<!--  根据实验id删除实验-->
  <update id="deleteCourseTestByTestId" parameterType="string">
    update course_test_t set delete_time=now() where test_id=#{testId}
  </update>
<!--  根据课程号删除课程实验-->
  <update id="deleteCourseTestByCid" parameterType="string">
    update course_test_t set delete_time=NOW() where cid=#{cid} and delete_time is null
  </update>
<!--  修改课程实验-->
  <update id="updateCourseTest" parameterType="com.xgksyjxpt.xgksyjxpt.course.domain.course.CourseTest">
    update course_test_t set test_name=#{test_name},test_image_name=#{test_image_name},test_description=#{test_description},test_start_time=#{test_start_time},
                             test_end_time=#{test_end_time},test_status=#{test_status} where test_id=#{test_id} and delete_time is null
  </update>
  <select id="selectByPrimaryKey" resultMap="ResultMapWithBLOBs" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Dec 18 16:38:23 CST 2022.
    -->
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from course_test_t
    where test_id = #{test_id,jdbcType=VARCHAR}
  </select>
<!--  根据课程号查询实验id-->
  <select id="selectCourseTestIdByCid" parameterType="string" resultType="string">
    select test_id from course_test_t where cid=#{cid} and delete_time is null
  </select>
<!--  查询所有实验信息-->
  <select id="queryAllCourseTest" resultType="com.xgksyjxpt.xgksyjxpt.course.domain.course.CourseTest">
    select
    <include refid="Base_Column_List"></include>
    from course_test_t where delete_time is null
    limit #{pageNum},#{pageSize}
  </select>
<!--  根据学号或者教师号查询实验-->
  <select id="queryAllCourseTestByTidOrSid" resultType="com.xgksyjxpt.xgksyjxpt.course.domain.course.CourseTest">
    select
    <if test="sid !=null and sid!='' and tid == null">
      ct.test_id, ct.cid, ct.chapter_id,ct.test_name, ct.test_image_name,ct.test_description,ct.test_start_time, ct.test_end_time,ct.test_status
      from course_test_t ct,student_test_t st where ct.delete_time is null and st.delete_time is null and st.sid=#{sid} and ct.test_id=st.test_id
      <if test="courseTest.cid !=null and courseTest.cid!=''">
        and ct.cid=#{courseTest.cid}
      </if>
      <if test="courseTest.testId !=null and courseTest.testId!=''">
        and ct.test_id like '%' #{courseTest.testId} '%'
      </if>
      <if test="courseTest.testName !=null and courseTest.testName!=''">
        and ct.test_name like '%' #{courseTest.testName} '%'
      </if>
      <if test="courseTest.testImageName !=null and courseTest.testImageName!=''">
        and ct.test_image_name like '%' #{courseTest.testImageName} '%'
      </if>
      <if test="courseTest.testStartTime !=null and courseTest.testStartTime!=''">
        and ct.test_start_time&gt;=#{courseTest.testStartTime}
      </if>
      <if test="courseTest.testEndTime !=null and courseTest.testEndTime!=''">
        and ct.test_end_time&lt;=#{courseTest.testEndTime}
      </if>
      <if test="courseTest.testStatus !=null and courseTest.testStatus!=''">
        and ct.test_status like '%' #{courseTest.testStatus} '%'
      </if>
      <if test="courseTest.chapterId !=null and courseTest.chapterId!=''">
        and ct.chapter_id=#{courseTest.chapterId}
      </if>
    </if>
    <if test="tid !=null and tid!='' and sid==null">
      ct.test_id, ct.cid, ct.chapter_id,ct.test_name, ct.test_image_name,ct.test_description,ct.test_start_time, ct.test_end_time,ct.test_status
      from course_test_t ct,course_t cct where ct.delete_time is null and cct.delete_time is null and cct.tid=#{tid} and ct.cid=cct.cid
      <if test="courseTest.cid !=null and courseTest.cid!=''">
        and ct.cid=#{courseTest.cid}
      </if>
      <if test="courseTest.testId !=null and courseTest.testId!=''">
        and ct.test_id like '%' #{courseTest.testId} '%'
      </if>
      <if test="courseTest.testName !=null and courseTest.testName!=''">
        and ct.test_name like '%' #{courseTest.testName} '%'
      </if>
      <if test="courseTest.testImageName !=null and courseTest.testImageName!=''">
        and ct.test_image_name like '%' #{courseTest.testImageName} '%'
      </if>
      <if test="courseTest.testStartTime !=null and courseTest.testStartTime!=''">
        and ct.test_start_time&gt;=#{courseTest.testStartTime}
      </if>
      <if test="courseTest.testEndTime !=null and courseTest.testEndTime!=''">
        and ct.test_end_time&lt;=#{courseTest.testEndTime}
      </if>
      <if test="courseTest.testStatus !=null and courseTest.testStatus!=''">
        and ct.test_status like '%' #{courseTest.testStatus} '%'
      </if>
      <if test="courseTest.chapterId !=null and courseTest.chapterId!=''">
        and ct.chapter_id=#{courseTest.chapterId}
      </if>
    </if>
    <if test="sid ==null and tid ==null ">
      <include refid="Base_Column_List" />
      from course_test_t where delete_time is null
      <if test="courseTest.cid !=null and courseTest.cid!=''">
        and cid=#{courseTest.cid}
      </if>
      <if test="courseTest.testId !=null and courseTest.testId!=''">
        and test_id like '%' #{courseTest.testId} '%'
      </if>
      <if test="courseTest.testName !=null and courseTest.testName!=''">
        and test_name like '%' #{courseTest.testName} '%'
      </if>
      <if test="courseTest.testImageName !=null and courseTest.testImageName!=''">
        and test_image_name like '%' #{courseTest.testImageName} '%'
      </if>
      <if test="courseTest.testStartTime !=null and courseTest.testStartTime!=''">
        and test_start_time&gt;=#{courseTest.testStartTime}
      </if>
      <if test="courseTest.testEndTime !=null and courseTest.testEndTime!=''">
        and test_end_time&lt;=#{courseTest.testEndTime}
      </if>
      <if test="courseTest.testStatus !=null and courseTest.testStatus!=''">
        and test_status like '%' #{courseTest.testStatus} '%'
      </if>
      <if test="courseTest.chapterId !=null and courseTest.chapterId!=''">
        and chapter_id=#{courseTest.chapterId}
      </if>
    </if>
    limit #{pageNum},#{pageSize}
  </select>
<!--  批量删除实验-->
  <update id="deleteCourseTestsByTestIds" parameterType="string">
    update course_test_t set delete_time=now() where test_id in (
        <foreach collection="array" item="ids" separator=",">
          #{ids}
        </foreach>
      ) and delete_time is null
  </update>
<!--  根据实验id查询实验-->
  <select id="selectCourseTestByTestId" parameterType="string" resultType="com.xgksyjxpt.xgksyjxpt.course.domain.course.CourseTest">
    select
    <include refid="Base_Column_List"></include>
    from course_test_t where test_id=#{testId} and delete_time is null
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Dec 18 16:38:23 CST 2022.
    -->
    delete from course_test_t
    where test_id = #{test_id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.xgksyjxpt.xgksyjxpt.course.domain.course.CourseTest" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Dec 18 16:38:23 CST 2022.
    -->
    insert into course_test_t (test_id, cid, test_name, 
      test_image_name, test_start_time, test_end_time, 
      test_description)
    values (#{test_id,jdbcType=VARCHAR}, #{cid,jdbcType=VARCHAR}, #{test_name,jdbcType=VARCHAR}, 
      #{test_image_name,jdbcType=VARCHAR}, #{test_start_time,jdbcType=TIMESTAMP}, #{test_end_time,jdbcType=TIMESTAMP}, 
      #{test_description,jdbcType=LONGVARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.xgksyjxpt.xgksyjxpt.course.domain.course.CourseTest" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Dec 18 16:38:23 CST 2022.
    -->
    insert into course_test_t
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="test_id != null" >
        test_id,
      </if>
      <if test="cid != null" >
        cid,
      </if>
      <if test="test_name != null" >
        test_name,
      </if>
      <if test="test_image_name != null" >
        test_image_name,
      </if>
      <if test="test_start_time != null" >
        test_start_time,
      </if>
      <if test="test_end_time != null" >
        test_end_time,
      </if>
      <if test="test_description != null" >
        test_description,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="test_id != null" >
        #{test_id,jdbcType=VARCHAR},
      </if>
      <if test="cid != null" >
        #{cid,jdbcType=VARCHAR},
      </if>
      <if test="test_name != null" >
        #{test_name,jdbcType=VARCHAR},
      </if>
      <if test="test_image_name != null" >
        #{test_image_name,jdbcType=VARCHAR},
      </if>
      <if test="test_start_time != null" >
        #{test_start_time,jdbcType=TIMESTAMP},
      </if>
      <if test="test_end_time != null" >
        #{test_end_time,jdbcType=TIMESTAMP},
      </if>
      <if test="test_description != null" >
        #{test_description,jdbcType=LONGVARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.xgksyjxpt.xgksyjxpt.course.domain.course.CourseTest" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Dec 18 16:38:23 CST 2022.
    -->
    update course_test_t
    <set >
      <if test="cid != null" >
        cid = #{cid,jdbcType=VARCHAR},
      </if>
      <if test="test_name != null" >
        test_name = #{test_name,jdbcType=VARCHAR},
      </if>
      <if test="test_image_name != null" >
        test_image_name = #{test_image_name,jdbcType=VARCHAR},
      </if>
      <if test="test_start_time != null" >
        test_start_time = #{test_start_time,jdbcType=TIMESTAMP},
      </if>
      <if test="test_end_time != null" >
        test_end_time = #{test_end_time,jdbcType=TIMESTAMP},
      </if>
      <if test="test_description != null" >
        test_description = #{test_description,jdbcType=LONGVARCHAR},
      </if>
    </set>
    where test_id = #{test_id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.xgksyjxpt.xgksyjxpt.course.domain.course.CourseTest" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Dec 18 16:38:23 CST 2022.
    -->
    update course_test_t
    set cid = #{cid,jdbcType=VARCHAR},
      test_name = #{test_name,jdbcType=VARCHAR},
      test_image_name = #{test_image_name,jdbcType=VARCHAR},
      test_start_time = #{test_start_time,jdbcType=TIMESTAMP},
      test_end_time = #{test_end_time,jdbcType=TIMESTAMP},
      test_description = #{test_description,jdbcType=LONGVARCHAR}
    where test_id = #{test_id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.xgksyjxpt.xgksyjxpt.course.domain.course.CourseTest" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Dec 18 16:38:23 CST 2022.
    -->
    update course_test_t
    set cid = #{cid,jdbcType=VARCHAR},
      test_name = #{test_name,jdbcType=VARCHAR},
      test_image_name = #{test_image_name,jdbcType=VARCHAR},
      test_start_time = #{test_start_time,jdbcType=TIMESTAMP},
      test_end_time = #{test_end_time,jdbcType=TIMESTAMP}
    where test_id = #{test_id,jdbcType=VARCHAR}
  </update>
</mapper>